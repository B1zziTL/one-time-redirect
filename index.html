<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>One-Time Redirect</title>
</head>
<body>
  <p id="message">Preparing your secure link...</p>
  <p id="output" style="word-break: break-all;"></p>

  <script type="module">
    import { scrtLink } from "https://scrt.link/api/v1/client-module";

    const API_KEY = "ak_FWfDgcKCZyTDmGzCkMKtwrlFwo12VUHDnMO6N8KFwrPCn1QfPEnDgiFZwqHCk8Ks";
    const TARGET_URL = "https://www.flexiquiz.com/SC/N/8e9790e3-ae28-46ef-9d08-a62e712f90fc";

    // üö´ Prevent duplicate generation in same browser
    if (localStorage.getItem("linkGenerated")) {
      document.getElementById("message").textContent =
        "‚ùå You've already generated your one-time link from this browser.";
      throw new Error("Link already generated in this browser");
    }

    const client = scrtLink(API_KEY);

    try {
      const result = await client.createSecret(TARGET_URL, {
        secretType: "redirect",
        expiresIn: 86400000, // 1 day
        views: 1
      });

      // ‚úÖ Save flag so they can't do it again
      localStorage.setItem("linkGenerated", "true");

      const fullLink = `https://scrt.link/s#${result.secretLink.split("#")[1]}`;
      document.getElementById("message").textContent = "‚úÖ One-time link created!";
      document.getElementById("output").innerHTML = `<a href="${fullLink}" target="_blank">${fullLink}</a>`;
    } catch (error) {
      document.getElementById("message").textContent =
        "‚ùå Failed to create link.";
      console.error(error);
    }
  </script>
</body>
</html>
